<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Before-After スライダー（ノブ操作のみ）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --maxw: 1100px; }
    body { font-family: system-ui, Arial, sans-serif; margin: 16px; }
    nav { margin: 0 auto 20px; max-width: var(--maxw); }
    nav a { margin-right: 14px; text-decoration: none; font-weight: 700; color: #0b62d6; }

    .slider-wrap { margin: 40px auto; max-width: var(--maxw); }
    .label { margin: 8px 0 12px; text-align: center; font-size: 20px; font-weight: 800; }

    .ba {
      position: relative;
      width: 100%;
      overflow: hidden;
      border-radius: 10px;
      box-shadow: 0 6px 16px rgba(0,0,0,.15);
      background: #000;
      user-select: none;
      touch-action: none;
    }

    .ba img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .ba .before {
      will-change: clip-path;
      clip-path: polygon(0 0, 50% 0, 50% 100%, 0 100%);
    }

    .handle {
      position: absolute;
      inset: 0 auto 0 50%;
      width: 3px;
      background: #fff;
      border-left: 1px solid rgba(0,0,0,.45);
      border-right: 1px solid rgba(0,0,0,.45);
      box-shadow: 0 0 0 1px rgba(255,255,255,.5);
      z-index: 2;
      pointer-events: none;
    }

    .knob {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 46px;
      height: 46px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid rgba(0,0,0,.35);
      box-shadow: 0 4px 10px rgba(0,0,0,.25), 0 0 0 3px rgba(255,255,255,.8) inset;
      z-index: 3;
      cursor: ew-resize;
      touch-action: none;
    }

    .knob:focus { outline: 3px solid #0b62d6; }

    /* ラベル共通 */
    .ba-label {
      position: absolute;
      padding: 4px 10px;
      font-size: 16px;
      font-weight: bold;
      color: #fff;
      background: rgba(0,0,0,0.55);
      border-radius: 4px;
      z-index: 4;
      pointer-events: none;
    }
    .ba-label.before-label {
      bottom: 8px;
      left: 8px;
    }
    .ba-label.after-label {
      bottom: 8px;
      right: 8px;
    }
  </style>
</head>
<body>

  <nav>
    <a href="#slider1">全域</a>
    <a href="#slider2">西側沿岸部</a>
    <a href="#slider3">市街地〜湿原の中間エリア</a>
    <a href="#slider4">東側山間部</a>
  </nav>

  <section id="slider1" class="slider-wrap">
    <div class="label">全域</div>
    <div class="ba" data-after="after.jpeg" data-before="before.jpeg"></div>
  </section>

  <section id="slider2" class="slider-wrap">
    <div class="label">西側沿岸部</div>
    <div class="ba" data-after="after1.jpeg" data-before="before1.jpeg"></div>
  </section>

  <section id="slider3" class="slider-wrap">
    <div class="label">市街地〜湿原の中間エリア</div>
    <div class="ba" data-after="after2.jpeg" data-before="before2.jpeg"></div>
  </section>

  <section id="slider4" class="slider-wrap">
    <div class="label">東側山間部</div>
    <div class="ba" data-after="after3.jpeg" data-before="before3.jpeg"></div>
  </section>

  <script>
    function initBA(container) {
      const afterSrc  = container.dataset.after;
      const beforeSrc = container.dataset.before;

      const probe = new Image();
      probe.src = afterSrc;
      probe.onload = () => {
        container.style.aspectRatio = `${probe.naturalWidth} / ${probe.naturalHeight}`;

        const after  = document.createElement('img');
        after.src = afterSrc; after.alt = 'after';

        const before = document.createElement('img');
        before.src = beforeSrc; before.alt = 'before'; before.className = 'before';

        const handle = document.createElement('div');
        handle.className = 'handle';

        const knob = document.createElement('button');
        knob.className = 'knob';
        knob.setAttribute('aria-label', 'スライダー位置を調整');
        knob.type = 'button';

        /* === ラベル追加 === */
        const beforeLabel = document.createElement('div');
        beforeLabel.className = 'ba-label before-label';
        beforeLabel.textContent = '2017年7月';

        const afterLabel = document.createElement('div');
        afterLabel.className = 'ba-label after-label';
        afterLabel.textContent = '2025年7月';

        container.appendChild(after);
        container.appendChild(before);
        container.appendChild(handle);
        container.appendChild(knob);
        container.appendChild(beforeLabel);
        container.appendChild(afterLabel);
        /* === ここまで === */

        let dragging = false;
        const setPos = (clientX) => {
          const r = container.getBoundingClientRect();
          const x = Math.max(0, Math.min(clientX - r.left, r.width));
          const p = (x / r.width) * 100;
          before.style.clipPath = `polygon(0 0, ${p}% 0, ${p}% 100%, 0 100%)`;
          handle.style.left = p + '%';
          knob.style.left   = p + '%';
        };

        knob.addEventListener('pointerdown', (e) => {
          dragging = true;
          knob.setPointerCapture(e.pointerId);
          e.preventDefault();
        });
        knob.addEventListener('pointermove', (e) => {
          if (!dragging) return;
          setPos(e.clientX);
        });
        knob.addEventListener('pointerup', () => { dragging = false; });

        knob.addEventListener('touchstart', (e) => { dragging = true; e.preventDefault(); }, {passive:false});
        window.addEventListener('touchmove', (e) => {
          if (!dragging) return;
          setPos(e.touches[0].clientX);
        }, {passive:false});
        window.addEventListener('touchend', () => { dragging = false; });

        knob.tabIndex = 0;
        knob.addEventListener('keydown', (e) => {
          const r = container.getBoundingClientRect();
          const current = parseFloat(handle.style.left || '50%') / 100 * r.width;
          const step = (e.shiftKey ? 20 : 10);
          if (e.key === 'ArrowLeft')  setPos(r.left + current - step);
          if (e.key === 'ArrowRight') setPos(r.left + current + step);
        });
      };
    }

    document.querySelectorAll('.ba').forEach(initBA);
  </script>
</body>
</html>
