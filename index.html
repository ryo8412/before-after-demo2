<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Before-After スライダー（伸縮なし）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --maxw: 1100px; }
    body { font-family: system-ui, Arial, sans-serif; margin: 16px; }
    nav { margin: 0 auto 20px; max-width: var(--maxw); }
    nav a { margin-right: 14px; text-decoration: none; font-weight: 700; color: #0b62d6; }

    .slider-wrap { margin: 40px auto; max-width: var(--maxw); }
    .label { margin: 8px 0 12px; text-align: center; font-size: 20px; font-weight: 800; }

    .ba {
      position: relative;
      width: 100%;
      overflow: hidden;
      border-radius: 10px;
      box-shadow: 0 6px 16px rgba(0,0,0,.15);
      background: #000;
      user-select: none;
      touch-action: none;
      /* after画像の実寸で縦横比固定（JSで設定） */
    }
    /* 両画像は常にコンテナと同じサイズ。伸縮させない */
    .ba img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    /* before画像は clip-path で見える範囲だけを変える */
    .ba .before {
      will-change: clip-path;
      clip-path: polygon(0 0, 50% 0, 50% 100%, 0 100%);
    }

    .handle {
      position: absolute;
      inset: 0 auto 0 50%;
      width: 3px;
      background: #fff;
      border-left: 1px solid rgba(0,0,0,.45);
      border-right: 1px solid rgba(0,0,0,.45);
      box-shadow: 0 0 0 1px rgba(255,255,255,.5);
      cursor: ew-resize;
      z-index: 2;
    }
  </style>
</head>
<body>

  <nav>
    <a href="#slider1">全域</a>
    <a href="#slider2">西側沿岸部</a>
    <a href="#slider3">市街地〜湿原の中間エリア</a>
    <a href="#slider4">東側山間部</a>
  </nav>

  <section id="slider1" class="slider-wrap">
    <div class="label">全域</div>
    <div class="ba" data-after="after.jpg" data-before="before.jpg"></div>
  </section>

  <section id="slider2" class="slider-wrap">
    <div class="label">西側沿岸部</div>
    <div class="ba" data-after="after1.jpg" data-before="before1.jpg"></div>
  </section>

  <section id="slider3" class="slider-wrap">
    <div class="label">市街地〜湿原の中間エリア</div>
    <div class="ba" data-after="after2.jpg" data-before="before2.jpg"></div>
  </section>

  <section id="slider4" class="slider-wrap">
    <div class="label">東側山間部</div>
    <div class="ba" data-after="after3.jpg" data-before="before3.jpg"></div>
  </section>

  <script>
    function initBA(container) {
      const afterSrc  = container.dataset.after;
      const beforeSrc = container.dataset.before;

      const probe = new Image();
      probe.src = afterSrc;
      probe.onload = () => {
        // 縦横比を固定（伸縮防止）
        container.style.aspectRatio = `${probe.naturalWidth} / ${probe.naturalHeight}`;

        const after  = document.createElement('img');
        after.src = afterSrc;  after.alt = 'after';

        const before = document.createElement('img');
        before.src = beforeSrc; before.alt = 'before'; before.className = 'before';

        const handle = document.createElement('div');
        handle.className = 'handle';

        container.appendChild(after);
        container.appendChild(before);
        container.appendChild(handle);

        let dragging = false;

        const setPos = (xClient) => {
          const r = container.getBoundingClientRect();
          const x = Math.max(0, Math.min(xClient - r.left, r.width));
          const p = (x / r.width) * 100;
          before.style.clipPath = `polygon(0 0, ${p}% 0, ${p}% 100%, 0 100%)`;
          handle.style.left = p + '%';
        };

        container.addEventListener('pointerdown', (e) => { dragging = true; setPos(e.clientX); });
        window.addEventListener('pointermove', (e) => { if (dragging) setPos(e.clientX); });
        window.addEventListener('pointerup',   ()  => { dragging = false; });

        // タッチでも動作
        container.addEventListener('touchstart', (e) => { dragging = true; setPos(e.touches[0].clientX); }, {passive:false});
        window.addEventListener('touchmove', (e) => { if (dragging) setPos(e.touches[0].clientX); }, {passive:false});
        window.addEventListener('touchend', () => { dragging = false; });
      };
    }

    document.querySelectorAll('.ba').forEach(initBA);
  </script>
</body>
</html>
